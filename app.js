class COIQuizApp {
    constructor() {
        this.questions = [
            {
id: 1,
question: "The power to form new states or change the boundaries of existing states rests with",
options: ["the Parliament", "the President", "the Election Commission", "none of these"],
correct: 0
},
{
id: 2,
question: "The states were reorganized on linguistic basis in",
options: ["1956", "1966", "1951", "1947"],
correct: 0
},
{
id: 3,
question: "Which state enjoys the distinction of being the first linguistic state of India?",
options: ["Andhra Pradesh", "West Bengal", "Tamil Nadu", "Punjab"],
correct: 0
},
{
id: 4,
question: "The structure of administration in various union territories",
options: ["is determined by the Parliament", "has been prescribed in the Constitution", "is determined by the Union Home Minister", "is determined by the President"],
correct: 0
},
{
id: 5,
question: "The administrators of Union Territories are designated as",
options: ["Lieutenant Governor", "Chief Commissioners", "Administrators", "all these"],
correct: 0
},
{
id: 6,
question: "What is the maximum percentage of jobs that can be reserved by a state for backward class people in government jobs?",
options: ["50%", "75%", "22.50%", "27%"],
correct: 0
},
{
id: 7,
question: "The President can dismiss a member of the Council of Ministers",
options: ["on the recommendation of the Prime Minister", "at his discretion", "with the consent of the Speaker", "none of these"],
correct: 0
},
{
id: 8,
question: "The President of India is bound to follow the advice given by the",
options: ["Union Council of Ministers", "Prime Minister of India", "Chief Justice of India", "Attorney General of India"],
correct: 0
},
{
id: 9,
question: "The ministers hold office during the pleasure of the President which in fact means during the pleasure of",
options: ["the Prime Minister", "the Parliament", "the Lok Sabha", "none of these"],
correct: 0
},
{
id: 10,
question: "A member of Parliament or a state legislature can be elected as President but",
options: ["he has to resign his seat before contesting the election", "he has to relinquish his seat as soon as he is elected", "he has to relinquish his seat within six months", "a state MLA cannot contest"],
correct: 0
},
{
id: 11,
question: "The Presidential address is prepared by",
options: ["the Prime Minister and his Cabinet", "the Special Secretary of the President", "the Minister for Parliamentary Affairs", "a Cabinet Minister of the President's choice"],
correct: 0
},
{
id: 12,
question: "To which of the following bills must the President accord his sanction without reconsideration?",
options: ["Money Bills", "Ordinary Bills", "Bills seeking amendment to the Constitution", "Bills passed by both Houses"],
correct: 0
},
{
id: 13,
question: "If a bill is returned by the President and re-passed by the Parliament, he",
options: ["has to sign it", "can send again", "can send to Supreme Court", "can reject it"],
correct: 0
},
{
id: 14,
question: "The defeat of government in Rajya Sabha leads to",
options: ["None of these", "dismissal", "PM resignation", "re-elections"],
correct: 0
},
{
id: 15,
question: "The minimum age to be appointed Prime Minister of India is",
options: ["25 years", "21 years", "30 years", "35 years"],
correct: 0
},
{
id: 16,
question: "If the Prime Minister resigns or dies",
options: ["the Council of Ministers stands dissolved", "senior most becomes PM", "Lok Sabha dissolves", "President chooses CM"],
correct: 0
},
{
id: 17,
question: "Who can dissolve the Lok Sabha before its full term?",
options: ["the President on recommendation of PM", "the Prime Minister", "the Speaker", "the President directly"],
correct: 0
},
{
id: 18,
question: "The President can call a joint session of Parliament",
options: ["under all these conditions", "if one House rejects bill", "if amendment is rejected", "if no action for six months"],
correct: 0
},
{
id: 19,
question: "Who presides over joint sessions of Parliament?",
options: ["the Speaker", "the Vice-President", "the President", "rotation system"],
correct: 0
},
{
id: 20,
question: "The Speaker uses casting vote",
options: ["in case of a tie", "to save government", "during emergencies", "constitutional amendments"],
correct: 0
},
{
id: 21,
question: "Lok Sabha passes vote on account to",
options: ["meet the expenditure during the period between the introduction of Budget and its passage", "to meet expenditure on secret services", "to enable the government to spend on unexpected demands", "assert its supremacy over finances"],
correct: 0
},
{
id: 22,
question: "The maximum gap between the two sessions of Parliament",
options: ["six months", "three months", "four months", "nine months"],
correct: 0
},
{
id: 23,
question: "Who convenes the joint sessions of the Lok Sabha and Rajya Sabha?",
options: ["the President", "the Speaker", "the Chairman of the Rajya Sabha", "the Minister for Parliamentary Affairs"],
correct: 0
},
{
id: 24,
question: "A Money Bill passed by the Lok Sabha can be delayed by the Rajya Sabha for a maximum period of",
options: ["14 days", "one month", "two months", "three months"],
correct: 0
},
{
id: 25,
question: "What happens if a Money Bill passed by the Lok Sabha is partially amended by the Rajya Sabha?",
options: ["the Lok Sabha can proceed with the Bill without the amendments proposed by the Rajya Sabha", "a joint sitting is called", "the bill lapses", "the Lok Sabha must return it to Rajya Sabha"],
correct: 0
},
{
id: 26,
question: "A Money Bill can originate",
options: ["only in the Lok Sabha", "in either house of Parliament", "only in the Rajya Sabha", "only in a joint sitting of both houses"],
correct: 0
},
{
id: 27,
question: "Which one of the following sets of Bills is presented to the Parliament along with the Budget?",
options: ["Finance Bill and Appropriation Bill", "Contingency Bill and Appropriation Bill", "Finance Bill and Contingency Bill", "Direct Taxes and Indirect Taxes Bill"],
correct: 0
},
{
id: 28,
question: "The Council of Ministers has to resign if a vote of no-confidence is passed against it",
options: ["by the Lok Sabha", "by the Rajya Sabha", "by both Houses jointly", "by two-thirds majority of both Houses"],
correct: 0
},
{
id: 29,
question: "Who decides whether a bill is a Money Bill or not?",
options: ["Speaker of Lok Sabha", "Prime Minister", "President", "Finance Minister"],
correct: 0
},
{
id: 30,
question: "The Parliament of India cannot be considered a sovereign body because",
options: ["laws passed can be declared unconstitutional by Supreme Court", "its authority is confined by Constitution", "Fundamental Rights restrict it", "all these"],
correct: 0
},
{
id: 31,
question: "In case of tie during voting at a joint sitting of Parliament",
options: ["the Speaker can cast a vote", "the bill is re-voted", "Rajya Sabha Chairman decides", "the bill is abandoned"],
correct: 0
},
{
id: 32,
question: "The Prime Minister is the link between",
options: ["the President and the Council of Ministers", "the President and Parliament", "Legislature and Executive", "all these"],
correct: 0
},
{
id: 33,
question: "The size of the Council of Ministers at the Centre is decided by the strength of the",
options: ["Lok Sabha", "Parliament", "Rajya Sabha", "no restriction"],
correct: 0
},
{
id: 34,
question: "The size of the Ministry in a state is decided by the",
options: ["Members of Legislative Assembly", "Chief Minister", "Governor", "None of these"],
correct: 0
},
{
id: 35,
question: "The seat of a member is declared vacant if he is",
options: ["absent for 60 days without permission", "involved in anti-party activity", "convicted with death sentence", "none of these"],
correct: 0
},
{
id: 36,
question: "Which is a constitutional convention followed in India?",
options: ["PM resigns if he loses majority", "Finance Minister must be from Lok Sabha", "All states represented in Cabinet", "Speaker acts as President in absence of both President & VP"],
correct: 0
},
{
id: 37,
question: "If the Prime Minister is from Rajya Sabha",
options: ["he cannot vote in no-confidence motion", "cannot speak in Lok Sabha", "can only speak in Rajya Sabha", "must become member of Lok Sabha within six months"],
correct: 0
},
{
id: 38,
question: "The duration of Zero Hour in Lok Sabha is",
options: ["One hour", "30 minutes", "15 minutes", "none of these"],
correct: 0
},
{
id: 39,
question: "According to the Preamble, our Constitution envisages",
options: ["All of these", "Economic justice", "Social justice", "Political justice"],
correct: 0
},
{
id: 40,
question: "The Union Budget is presented to Parliament normally on",
options: ["the last day of February", "the last day of March", "15th March", "1st April"],
correct: 0
},
{
id: 41,
question: "The maximum permissible interval between two sessions of Parliament as prescribed in our Constitution is",
options: ["06 months", "03 months", "One year", "09 months"],
correct: 0
},
{
id: 42,
question: "The Constitution of India does not mention the post of",
options: ["Deputy Prime Minister of India", "Deputy Speaker of Lok Sabha", "Deputy Chairperson of Rajya Sabha", "All these"],
correct: 0
},
{
id: 43,
question: "India is a Republic because",
options: ["the head of the State is elected for a fixed tenure", "it is a member of commonwealth", "it has an elected parliament", "it has a written Constitution"],
correct: 0
},
{
id: 44,
question: "Indian Constitution provides for a",
options: ["Bicameral system", "Presidential System", "Unicameral system", "Unitary System"],
correct: 0
},
{
id: 45,
question: "An interpretation of the Indian Constitution is based on the spirit of the",
options: ["Preamble", "Directive Principles of State Policy", "Fundamental Rights", "Fundamental Duties"],
correct: 0
},
{
id: 46,
question: "The size of the Council of Ministers is decided by",
options: ["Strength of Lok Sabha", "Parliament", "Election Commission", "President of India"],
correct: 0
},
{
id: 47,
question: "The words ‘socialist secular’ and ‘and integrity’ were added to the Preamble by the ______ Amendment",
options: ["42nd", "44th", "25th", "None of these"],
correct: 0
},
{
id: 48,
question: "India aims to establish itself as a",
options: ["Welfare State", "Secular State", "Sovereign State", "Developed State"],
correct: 0
},
{
id: 49,
question: "Who described the Prime Minister of India as ‘Primus Inter Pares’ (first among equals)?",
options: ["Lord Morley", "Sir William Vernon", "Harold Laski", "K. M. Munshi"],
correct: 0
},
{
id: 50,
question: "The President decides on disqualification of Members of Parliament in consultation with the",
options: ["Election Commission", "Prime Minister", "Speaker", "Chief Justice of India"],
correct: 0
},
{
id: 51,
question: "Which article provides that there shall be a Prime Minister of India?",
options: ["Art. 74", "Art. 52", "Art. 124", "Art. 153"],
correct: 0
},
{
id: 52,
question: "Who announces the Government policies on the floor of the House?",
options: ["Prime Minister", "Speaker of Lok Sabha", "President", "Finance Minister"],
correct: 0
},
{
id: 53,
question: "Who presides over the meetings of the Union Council of Ministers?",
options: ["Prime Minister", "President", "Speaker of Lok Sabha", "Vice President"],
correct: 0
},
{
id: 54,
question: "Council of Ministers shall hold the office during the pleasure of",
options: ["President", "Members of the House", "Speaker", "Prime Minister"],
correct: 0
},
{
id: 55,
question: "Budget in Indian Constitution is classified into",
options: ["Two types", "Three types", "Four types", "No such classification"],
correct: 0
},
{
id: 56,
question: "Who is referred to as one of the officers of Parliament?",
options: ["Deputy Speaker", "Prime Minister", "Council of Ministers", "None of these"],
correct: 0
},
{
id: 57,
question: "Joint session is called in case of deadlock between the two Houses with regard to",
options: ["Both Ordinary and Financial Bill", "Money Bill", "Financial Bill", "Ordinary Bill"],
correct: 0
},
{
id: 58,
question: "According to the 91st Constitutional Amendment (2003), the total strength of Council of Ministers should not exceed ______ of Lok Sabha strength.",
options: ["15%", "10%", "25%", "22.50%"],
correct: 0
},
{
id: 59,
question: "The President of India can nominate to the Rajya Sabha",
options: ["12 members", "20 members", "8 members", "None"],
correct: 0
},
{
id: 60,
question: "The number of Ministers in the Central Government is fixed by the",
options: ["Prime Minister", "President", "Parliament", "Speaker"],
correct: 0
},
{
id: 61,
question: "The salaries and allowances of the members of the Council of Ministers",
options: ["are determined by the Parliament from time to time", "are fixed in the Constitution", "are determined by the President with PM's advice", "are fixed by the Speaker"],
correct: 0
},
{
id: 62,
question: "The power to control the expenditure of the Government of India rests exclusively with",
options: ["the Comptroller and Auditor General", "the Parliament", "the President", "the Union Finance Minister"],
correct: 0
},
{
id: 63,
question: "Who appoints the Chief Minister of a State?",
options: ["Governor of that State", "Prime Minister of India", "President of India", "Chief Justice of High Court"],
correct: 0
},
{
id: 64,
question: "The Chief Minister, who is the head of the government in a state, is",
options: ["appointed by the Governor", "elected directly by the people", "appointed by the President", "appointed by Governor on advice of High Court"],
correct: 0
},
{
id: 65,
question: "Who is regarded as the head of the State Council of Ministers?",
options: ["the Chief Minister", "the Governor", "the Speaker", "None of these"],
correct: 0
},
{
id: 66,
question: "A member of the council of ministers can hold office without being a member of the state legislature for a maximum period of",
options: ["six months", "three months", "one year", "two years"],
correct: 0
},
{
id: 67,
question: "Who among the following enjoys the distinction of being the first woman Dalit Chief Minister of a state?",
options: ["Mayawati", "Nandani Satpathy", "Padmaja Naidu", "Sarojini Naidu"],
correct: 0
},
{
id: 68,
question: "Some Indian states have bicameral legislatures. Their two houses are called",
options: ["Legislative Assembly and Legislative Council", "Sabha and Samiti", "Lok Sabha and Legislative Council", "Assembly and Senate"],
correct: 0
},
{
id: 69,
question: "Members of the Legislative Assembly are",
options: ["elected by the people", "elected by local bodies", "nominated by Governor", "all of these"],
correct: 0
},
{
id: 70,
question: "The chairman of the Legislative Council is",
options: ["elected by its members", "appointed by the Governor", "ex-officio", "appointed by Speaker"],
correct: 0
},
{
id: 71,
question: "States enjoy exclusive jurisdiction over subjects in the",
options: ["State List", "Concurrent List", "Both A and B", "None"],
correct: 0
},
{
id: 72,
question: "The central government can assign any function to the state with the consent of",
options: ["the state government", "the President", "the Parliament", "the Chief Justice of India"],
correct: 0
},
{
id: 73,
question: "Which type of global citizen emphasizes international law and human rights?",
options: ["Legal", "Economic", "Social", "Local"],
correct: 0
},
{
id: 74,
question: "A digital global citizen mainly uses",
options: ["social networks to promote and discuss global issues", "national databases", "paper-based records", "government portals"],
correct: 0
},
{
id: 75,
question: "Which type of global citizenship deals with cross-cultural understanding?",
options: ["Cultural", "Political", "Environmental", "Economic"],
correct: 0
},
{
id: 76,
question: "Which best defines globalization?",
options: ["Enhanced global integration", "Cultural divergence", "Regional isolation", "Closed economies"],
correct: 0
},
{
id: 77,
question: "Globalization leads to",
options: ["Mutual global interdependence", "Increased domination", "Cultural stagnation", "Trade barriers"],
correct: 0
},
{
id: 78,
question: "Interconnectedness promotes",
options: ["Shared solutions to global problems", "neo-colonial dependence", "regional wars", "cultural conflicts"],
correct: 0
},
{
id: 79,
question: "Which trait is essential to be a global citizen?",
options: ["Tolerance", "Ethnocentrism", "Isolationism", "All of these"],
correct: 0
},
{
id: 80,
question: "A Global Citizen is expected to",
options: ["Act locally; think globally", "Ignore global events", "Focus only on personal gain", "Avoid community involvement"],
correct: 0
},
{
id: 81,
question: "Who is called the ‘Father of Panchayat Raj System’ in India?",
options: ["Balwant Rai Mehta", "L M Singhvi", "G V K Rao", "Ashok Mehta"],
correct: 0
},
{
id: 82,
question: "Which is the primary and permanent body of the Panchayat Raj system?",
options: ["Gram Sabha", "Standing Committee", "Khap Panchayat", "None of these"],
correct: 0
},
{
id: 83,
question: "Panchayat Raj is a",
options: ["Three tier system", "Single tier system", "Four tier system", "Two tier system"],
correct: 0
},
{
id: 84,
question: "Global Citizenship primarily emphasizes",
options: ["Global interconnectedness", "National pride", "Religious priorities", "Family ties"],
correct: 0
},
{
id: 85,
question: "Which one is not a type of global citizenship?",
options: ["Exclusive global citizenship", "Corporate global citizenship", "Ethical global citizenship", "Active global citizenship"],
correct: 0
},
{
id: 86,
question: "A person who actively participates in global causes can be called a",
options: ["Active global citizen", "Digital global citizen", "Nominal global citizen", "Passive global citizen"],
correct: 0
},
{
id: 87,
question: "Which type of global citizen emphasizes international law and human rights?",
options: ["Legal", "Economic", "Social", "Local"],
correct: 0
},
{
id: 88,
question: "A digital global citizen mainly uses",
options: ["social networks to promote and deliberate on global issues", "national databases", "paper-based records", "government portals"],
correct: 0
},
{
id: 89,
question: "Which type of global citizenship deals with cross-cultural understanding?",
options: ["Cultural", "Political", "Environmental", "Economic"],
correct: 0
},
{
id: 90,
question: "Which best defines globalization?",
options: ["Enhanced global integration", "Cultural divergence", "Regional isolation", "Closed economies"],
correct: 0
},
{
id: 91,
question: "Globalization leads to",
options: ["Mutual global interdependence", "Dominance", "Cultural stagnation", "Trade barriers"],
correct: 0
},
{
id: 92,
question: "Interconnectedness promotes",
options: ["Shared solutions to global problems", "Dependence between nations", "Regional wars", "Conflict"],
correct: 0
},
{
id: 93,
question: "Which trait is essential to be a global citizen?",
options: ["Tolerance", "Ethnocentrism", "Isolationism", "All of these"],
correct: 0
},
{
id: 94,
question: "A global citizen must",
options: ["Respect others’ rights", "Ignore global crisis", "Promote discrimination", "Act against social justice"],
correct: 0
},
{
id: 95,
question: "Which is not a responsibility of global citizens?",
options: ["Ignoring refugee crisis", "Respecting diversity", "Environmental stewardship", "Engaging in global challenges"],
correct: 0
},
{
id: 96,
question: "Ethics in global citizenship refers to",
options: ["Moral principles guiding global conduct", "Legal rules", "Personal profit", "Religious teachings"],
correct: 0
},
{
id: 97,
question: "The 3Rs of sustainability include",
options: ["Reduce, Reuse, Recycle", "Reduce, Rebuild, Replant", "Reduce, Reuse, Reform", "Reduce, Recycle, Reward"],
correct: 0
},
{
id: 98,
question: "Supporting international aid efforts reflects",
options: ["Global solidarity", "Nationalism", "Economic expansion", "Mercantilism"],
correct: 0
},
{
id: 99,
question: "Sharing knowledge across cultures is an example of",
options: ["Global Cooperation", "National responsibility", "Cultural dominance", "Colonialism"],
correct: 0
},
{
id: 100,
question: "Choosing eco-friendly transportation supports",
options: ["Sustainability", "Cultural heritage", "Political reforms", "Global inequality"],
correct: 0
},
];

        this.currentQuestions = [];
        this.currentQuestionIndex = 0;
        this.answers = {};
        this.timeRemaining = 20 * 60; // 20 minutes in seconds
        this.timer = null;
        this.startTime = null;
        this.studentName = '';

        // Initialize after DOM is ready
        this.initializeEventListeners();
    }

    initializeEventListeners() {
        // Wait for DOM elements to be available
        const startBtn = document.getElementById('startQuizBtn');
        const adminBtn = document.getElementById('adminLoginBtn');
        
        if (startBtn) {
            startBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.startQuiz();
            });
        }

        if (adminBtn) {
            adminBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.showAdminModal();
            });
        }

        // Quiz navigation
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        if (prevBtn) prevBtn.addEventListener('click', () => this.previousQuestion());
        if (nextBtn) nextBtn.addEventListener('click', () => this.nextQuestion());
        if (submitBtn) submitBtn.addEventListener('click', () => this.submitQuiz());

        // Results screen
        const reviewBtn = document.getElementById('reviewAnswersBtn');
        const newQuizBtn = document.getElementById('newQuizBtn');

        if (reviewBtn) reviewBtn.addEventListener('click', () => this.showReview());
        if (newQuizBtn) newQuizBtn.addEventListener('click', () => this.newQuiz());

        // Review screen
        const backBtn = document.getElementById('backToResultsBtn');
        if (backBtn) backBtn.addEventListener('click', () => this.showResults());

        // Admin
        const adminLoginSubmit = document.getElementById('adminLoginSubmit');
        const adminModalClose = document.getElementById('adminModalClose');
        const logoutBtn = document.getElementById('logoutBtn');
        const exportBtn = document.getElementById('exportBtn');

        if (adminLoginSubmit) adminLoginSubmit.addEventListener('click', () => this.adminLogin());
        if (adminModalClose) adminModalClose.addEventListener('click', () => this.hideAdminModal());
        if (logoutBtn) logoutBtn.addEventListener('click', () => this.adminLogout());
        if (exportBtn) exportBtn.addEventListener('click', () => this.exportCSV());

        // Handle name input
        const nameInput = document.getElementById('studentName');
        if (nameInput) {
            nameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    this.startQuiz();
                }
            });
            
            // Ensure input focus works properly
            nameInput.addEventListener('click', () => {
                nameInput.focus();
            });
        }
    }

    shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    shuffleQuestionOptions(question) {
        const shuffled = { ...question };
        const optionsWithIndex = question.options.map((option, index) => ({ option, originalIndex: index }));
        const shuffledOptions = this.shuffleArray(optionsWithIndex);
        
        shuffled.options = shuffledOptions.map(item => item.option);
        shuffled.correct = shuffledOptions.findIndex(item => item.originalIndex === question.correct);
        
        return shuffled;
    }

    prepareRandomQuestions() {
        // Select 40 random questions from 91
        const shuffledQuestions = this.shuffleArray(this.questions);
        const selectedQuestions = shuffledQuestions.slice(0, 40);
        
        // Shuffle options for each question
        this.currentQuestions = selectedQuestions.map(q => this.shuffleQuestionOptions(q));
        
        // Shuffle the order of selected questions
        this.currentQuestions = this.shuffleArray(this.currentQuestions);
    }

    startQuiz() {
        const nameInput = document.getElementById('studentName');
        
        if (!nameInput || !nameInput.value.trim()) {
            alert('Please enter your name before starting the quiz.');
            if (nameInput) nameInput.focus();
            return;
        }

        this.studentName = nameInput.value.trim();
        this.prepareRandomQuestions();
        this.currentQuestionIndex = 0;
        this.answers = {};
        this.timeRemaining = 20 * 60;
        this.startTime = Date.now();

        this.showScreen('quizScreen');
        this.displayQuestion();
        this.startTimer();
    }

    startTimer() {
        if (this.timer) {
            clearInterval(this.timer);
        }
        
        this.timer = setInterval(() => {
            this.timeRemaining--;
            this.updateTimerDisplay();

            if (this.timeRemaining <= 5 * 60) { // 5 minutes warning
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.classList.add('warning');
                }
            }

            if (this.timeRemaining <= 0) {
                this.submitQuiz();
            }
        }, 1000);
    }

    updateTimerDisplay() {
        const timerElement = document.getElementById('timer');
        if (timerElement) {
            const minutes = Math.floor(this.timeRemaining / 60);
            const seconds = this.timeRemaining % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
    }

    displayQuestion() {
        const question = this.currentQuestions[this.currentQuestionIndex];
        const questionNumber = this.currentQuestionIndex + 1;

        // Update question counter
        const counterElement = document.getElementById('questionCounter');
        if (counterElement) {
            counterElement.textContent = `Question ${questionNumber} of 40`;
        }

        // Update question text
        const questionTextElement = document.getElementById('questionText');
        if (questionTextElement) {
            questionTextElement.textContent = question.question;
        }

        // Update options
        const optionsContainer = document.getElementById('optionsContainer');
        if (optionsContainer) {
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'answer';
                radio.value = index;
                radio.id = `option${index}`;

                const label = document.createElement('label');
                label.htmlFor = `option${index}`;
                label.textContent = option;

                optionDiv.appendChild(radio);
                optionDiv.appendChild(label);

                // Check if this answer was previously selected
                if (this.answers[question.id] === index) {
                    radio.checked = true;
                    optionDiv.classList.add('selected');
                }

                // Add click handler
                optionDiv.addEventListener('click', () => {
                    // Remove selected class from all options
                    optionsContainer.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Add selected class to clicked option
                    optionDiv.classList.add('selected');
                    radio.checked = true;
                    
                    // Save answer
                    this.answers[question.id] = index;
                });

                optionsContainer.appendChild(optionDiv);
            });
        }

        // Update progress bar
        const progressBar = document.getElementById('progressBar');
        if (progressBar) {
            const progress = (questionNumber / 40) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Update navigation buttons
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        if (prevBtn) prevBtn.disabled = questionNumber === 1;
        
        if (nextBtn) {
            nextBtn.style.display = questionNumber === 40 ? 'none' : 'block';
        }
        
        if (submitBtn) {
            submitBtn.style.display = questionNumber === 40 ? 'block' : 'none';
        }
    }

    previousQuestion() {
        if (this.currentQuestionIndex > 0) {
            this.currentQuestionIndex--;
            this.displayQuestion();
        }
    }

    nextQuestion() {
        if (this.currentQuestionIndex < this.currentQuestions.length - 1) {
            this.currentQuestionIndex++;
            this.displayQuestion();
        }
    }

    submitQuiz() {
        if (this.timer) {
            clearInterval(this.timer);
        }

        const endTime = Date.now();
        const timeTaken = Math.floor((endTime - this.startTime) / 1000);

        // Calculate results
        let correct = 0;
        let wrong = 0;
        let unanswered = 0;

        this.currentQuestions.forEach(question => {
            if (this.answers.hasOwnProperty(question.id)) {
                if (this.answers[question.id] === question.correct) {
                    correct++;
                } else {
                    wrong++;
                }
            } else {
                unanswered++;
            }
        });

        const scorePercentage = Math.round((correct / 40) * 100);

        // Save results
        this.saveResult({
            name: this.studentName,
            score: scorePercentage,
            correct: correct,
            wrong: wrong,
            unanswered: unanswered,
            timeTaken: timeTaken,
            date: new Date().toLocaleDateString(),
            answers: { ...this.answers },
            questions: [...this.currentQuestions]
        });

        // Display results
        this.displayResults(scorePercentage, correct, wrong, unanswered, timeTaken);
    }

    displayResults(scorePercentage, correct, wrong, unanswered, timeTaken) {
        const elements = {
            studentNameDisplay: document.getElementById('studentNameDisplay'),
            scorePercentage: document.getElementById('scorePercentage'),
            correctCount: document.getElementById('correctCount'),
            wrongCount: document.getElementById('wrongCount'),
            unansweredCount: document.getElementById('unansweredCount'),
            timeTaken: document.getElementById('timeTaken')
        };

        if (elements.studentNameDisplay) elements.studentNameDisplay.textContent = this.studentName;
        if (elements.scorePercentage) elements.scorePercentage.textContent = `${scorePercentage}%`;
        if (elements.correctCount) elements.correctCount.textContent = correct;
        if (elements.wrongCount) elements.wrongCount.textContent = wrong;
        if (elements.unansweredCount) elements.unansweredCount.textContent = unanswered;

        if (elements.timeTaken) {
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            elements.timeTaken.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        this.showScreen('resultsScreen');
    }

    showReview() {
        const reviewContainer = document.getElementById('reviewQuestions');
        if (!reviewContainer) return;
        
        reviewContainer.innerHTML = '';

        // Update summary
        let correct = 0, wrong = 0, unanswered = 0;
        
        this.currentQuestions.forEach((question) => {
            if (this.answers.hasOwnProperty(question.id)) {
                if (this.answers[question.id] === question.correct) {
                    correct++;
                } else {
                    wrong++;
                }
            } else {
                unanswered++;
            }
        });

        const summaryElements = {
            reviewCorrectCount: document.getElementById('reviewCorrectCount'),
            reviewWrongCount: document.getElementById('reviewWrongCount'),
            reviewUnansweredCount: document.getElementById('reviewUnansweredCount')
        };

        if (summaryElements.reviewCorrectCount) summaryElements.reviewCorrectCount.textContent = correct;
        if (summaryElements.reviewWrongCount) summaryElements.reviewWrongCount.textContent = wrong;
        if (summaryElements.reviewUnansweredCount) summaryElements.reviewUnansweredCount.textContent = unanswered;

        // Create review for each question
        this.currentQuestions.forEach((question, index) => {
            const reviewDiv = document.createElement('div');
            reviewDiv.className = 'review-question';

            const userAnswer = this.answers[question.id];
            const isCorrect = userAnswer === question.correct;
            const isAnswered = userAnswer !== undefined;

            if (isAnswered) {
                reviewDiv.classList.add(isCorrect ? 'correct' : 'wrong');
            } else {
                reviewDiv.classList.add('unanswered');
            }

            reviewDiv.innerHTML = `
                <div class="review-question-header">
                    <span class="review-question-number">Question ${index + 1}</span>
                    <span class="review-status">
                        ${isAnswered ? (isCorrect ? '✅' : '❌') : '❓'}
                    </span>
                </div>
                <div class="review-question-text">${question.question}</div>
                <div class="review-options">
                    ${question.options.map((option, optIndex) => {
                        let className = 'review-option';
                        if (optIndex === question.correct) {
                            className += ' correct';
                        } else if (optIndex === userAnswer && !isCorrect) {
                            className += ' selected-wrong';
                        }
                        return `<div class="${className}">${String.fromCharCode(65 + optIndex)}. ${option}</div>`;
                    }).join('')}
                </div>
            `;

            reviewContainer.appendChild(reviewDiv);
        });

        this.showScreen('reviewScreen');
    }

    showResults() {
        this.showScreen('resultsScreen');
    }

    newQuiz() {
        // Reset timer display
        const timerElement = document.getElementById('timer');
        if (timerElement) {
            timerElement.classList.remove('warning');
        }
        
        // Clear student name for new quiz
        const nameInput = document.getElementById('studentName');
        if (nameInput) {
            nameInput.value = '';
        }
        
        this.showScreen('welcomeScreen');
    }

    saveResult(result) {
        try {
            let results = JSON.parse(localStorage.getItem('uhvQuizResults') || '[]');
            results.push(result);
            localStorage.setItem('uhvQuizResults', JSON.stringify(results));
        } catch (error) {
            console.error('Error saving result:', error);
        }
    }

    showAdminModal() {
    const modal = document.getElementById('adminModal');
    if (modal) modal.classList.add('active');
    }

    hideAdminModal() {
    const modal = document.getElementById('adminModal');
    const usernameInput = document.getElementById('adminUsername');
    const passwordInput = document.getElementById('adminPassword');
    if (modal) modal.classList.remove('active');
    if (usernameInput) usernameInput.value = '';
    if (passwordInput) passwordInput.value = '';
    }


    adminLogin() {
        const usernameInput = document.getElementById('adminUsername');
        const passwordInput = document.getElementById('adminPassword');
        
        if (!usernameInput || !passwordInput) return;
        
        const username = usernameInput.value;
        const password = passwordInput.value;

        if (username === 'sam' && password === '2525') {
            this.hideAdminModal();
            this.showAdminDashboard();
        } else {
            alert('Invalid credentials. Please try again.');
        }   

    }

    adminLogout() {
        this.showScreen('welcomeScreen');
    }

    showAdminDashboard() {
        try {
            const results = JSON.parse(localStorage.getItem('uhvQuizResults') || '[]');
            
            // Update statistics
            const elements = {
                totalStudents: document.getElementById('totalStudents'),
                averageScore: document.getElementById('averageScore'),
                completionRate: document.getElementById('completionRate'),
                studentTableBody: document.getElementById('studentTableBody')
            };

            if (elements.totalStudents) {
                elements.totalStudents.textContent = results.length;
            }
            
            if (elements.averageScore) {
                const averageScore = results.length > 0 
                    ? Math.round(results.reduce((sum, r) => sum + r.score, 0) / results.length)
                    : 0;
                elements.averageScore.textContent = `${averageScore}%`;
            }
            
            if (elements.completionRate) {
                const completionRate = results.length > 0 
                    ? Math.round((results.filter(r => r.correct + r.wrong + r.unanswered === 40).length / results.length) * 100)
                    : 0;
                elements.completionRate.textContent = `${completionRate}%`;
            }

            // Update table
            if (elements.studentTableBody) {
                elements.studentTableBody.innerHTML = '';

                results.slice(-20).reverse().forEach(result => { // Show last 20 results
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${result.name}</td>
                        <td>${result.score}%</td>
                        <td>${result.correct}</td>
                        <td>${result.wrong}</td>
                        <td>${result.unanswered}</td>
                        <td>${Math.floor(result.timeTaken / 60)}:${(result.timeTaken % 60).toString().padStart(2, '0')}</td>
                        <td>${result.date}</td>
                    `;
                    elements.studentTableBody.appendChild(row);
                });
            }

            this.showScreen('adminScreen');
        } catch (error) {
            console.error('Error loading admin dashboard:', error);
            alert('Error loading dashboard data.');
        }
    }

    exportCSV() {
        try {
            const results = JSON.parse(localStorage.getItem('uhvQuizResults') || '[]');
            
            if (results.length === 0) {
                alert('No data to export.');
                return;
            }

            const headers = ['Name', 'Score (%)', 'Correct', 'Wrong', 'Unanswered', 'Time Taken', 'Date'];
            const csvContent = [
                headers.join(','),
                ...results.map(result => [
                    `"${result.name}"`,
                    result.score,
                    result.correct,
                    result.wrong,
                    result.unanswered,
                    `"${Math.floor(result.timeTaken / 60)}:${(result.timeTaken % 60).toString().padStart(2, '0')}"`,
                    `"${result.date}"`
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `uhv_quiz_results_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        } catch (error) {
            console.error('Error exporting CSV:', error);
            alert('Error exporting data.');
        }
    }

    showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
            targetScreen.classList.add('active');
        }
    }
}

// Initialize the application when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new COIQuizApp();
});